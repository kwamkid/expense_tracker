{# app/templates/accounts/bento.html - Bento UI style #}
{% extends "base.html" %}

{% block extra_css %}
<style>
  /* Bento Account Grid */
  .bento-accounts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }

  @media (max-width: 768px) {
    .bento-accounts-grid {
      grid-template-columns: 1fr;
    }
  }

  .account-card {
    background-color: white;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    overflow: hidden;
    transition: all 0.3s;
    height: 100%;
    position: relative;
  }

  .account-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  }

  .account-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px;
    background-color: var(--primary-color);
  }

  .account-card.active {
    border: 2px solid var(--success-color);
  }

  .account-card.inactive {
    opacity: 0.7;
  }

  .account-card.inactive::before {
    background-color: var(--gray-500);
  }

  .account-header {
    padding: 16px;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .account-name {
    font-weight: 600;
    margin: 0;
    font-size: 1.1rem;
  }

  .account-body {
    padding: 20px 16px;
  }

  .account-balance {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 10px;
  }

  .account-footer {
    padding: 12px 16px;
    border-top: 1px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
  }

  .account-created {
    color: #666;
    font-size: 0.8rem;
  }

  .action-buttons {
    display: flex;
    gap: 8px;
  }

  .action-buttons .btn {
    padding: 6px 10px;
    font-size: 0.85rem;
  }

  .empty-state {
    background-color: white;
    border-radius: 16px;
    padding: 40px 20px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  }

  .empty-state-icon {
    font-size: 3rem;
    color: var(--gray-400);
    margin-bottom: 1rem;
  }

  .empty-state-text {
    color: var(--gray-600);
    margin-bottom: 1.5rem;
  }

  /* Add account FAB for mobile */
  .add-account-fab {
    position: fixed;
    bottom: 70px;
    right: 20px;
    width: 56px;
    height: 56px;
    border-radius: 28px;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    z-index: 1000;
  }

  /* Delete modal style */
  .modal-bento .modal-content {
    border-radius: 20px;
    border: none;
    overflow: hidden;
  }

  .modal-bento .modal-header {
    background-color: var(--primary-color);
    color: white;
    border-bottom: none;
  }

  .modal-bento .modal-footer {
    border-top: none;
    padding: 1rem;
  }

  .modal-bento .btn-close {
    color: white;
  }

  /* Quick info cards */
  .quick-info-wrapper {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }

  .quick-info-card {
    background-color: white;
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    text-align: center;
  }

  .quick-info-card .value {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 10px 0;
  }

  .quick-info-card .label {
    color: #666;
    font-size: 0.9rem;
  }

  .quick-info-card.success {
    background-color: rgba(76, 175, 80, 0.1);
  }

  .quick-info-card.danger {
    background-color: rgba(244, 67, 54, 0.1);
  }

  .quick-info-card.primary {
    background-color: rgba(102, 103, 171, 0.1);
  }

  /* Mobile Bottom Navigation */
  .mobile-bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: white;
    display: flex;
    justify-content: space-around;
    padding: 12px 0 8px;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
    z-index: 1000;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
  }

  .mobile-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    color: var(--gray-600);
  }

  .mobile-nav-item.active {
    color: var(--primary-color);
  }

  .mobile-nav-item i {
    font-size: 1.2rem;
    margin-bottom: 4px;
  }

  .mobile-nav-item span {
    font-size: 0.7rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="content-wrapper">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">
      <i class="fas fa-wallet text-primary me-2"></i>บัญชีของฉัน
    </h2>
    <a href="{{ url_for('accounts.create') }}" class="btn btn-primary d-none d-md-inline-flex">
      <i class="fas fa-plus me-2"></i>เพิ่มบัญชีใหม่
    </a>
  </div>

  <!-- Quick Info Summary -->
  <div class="quick-info-wrapper">
    <div class="quick-info-card primary">
      <div class="label">บัญชีทั้งหมด</div>
      <div class="value counter-animate" data-target="{{ accounts|length }}" data-decimals="0">{{ accounts|length }}</div>
      <div><i class="fas fa-wallet"></i></div>
    </div>

    <div class="quick-info-card success">
      <div class="label">รวมยอดบวก</div>
      <div class="value text-success counter-animate" data-target="{{ total_positive }}" data-prefix="" data-suffix=" ฿" data-decimals="2">{{ "{:,.2f}".format(total_positive) }} ฿</div>
      <div><i class="fas fa-plus-circle text-success"></i></div>
    </div>

    <div class="quick-info-card danger">
      <div class="label">รวมยอดลบ</div>
      <div class="value text-danger counter-animate" data-target="{{ total_negative }}" data-prefix="" data-suffix=" ฿" data-decimals="2">{{ "{:,.2f}".format(total_negative) }} ฿</div>
      <div><i class="fas fa-minus-circle text-danger"></i></div>
    </div>
  </div>

  {% if accounts|length > 0 %}
  <div class="bento-accounts-grid">
    {% for account in accounts %}
    <div class="account-card {{ 'active' if account.is_active else 'inactive' }}">
      <div class="account-header">
        <h5 class="account-name">{{ account.name }}</h5>
        <div>
          {% if account.is_active %}
          <span class="badge bg-success">ใช้งาน</span>
          {% else %}
          <span class="badge bg-secondary">ไม่ใช้งาน</span>
          {% endif %}
        </div>
      </div>
      <div class="account-body">
        <div class="account-balance {{ 'text-success' if account.balance >= 0 else 'text-danger' }}">
          {{ "{:,.2f}".format(account.balance) }} ฿
        </div>
        <div class="account-created">
          <i class="fas fa-calendar-alt me-1 text-muted"></i> สร้างเมื่อ {{ account.created_at.strftime('%d/%m/%Y') }}
        </div>
      </div>
      <div class="account-footer">
        <a href="{{ url_for('transactions.index', account_id=account.id) }}" class="btn btn-sm btn-outline-primary">
          <i class="fas fa-list me-1"></i>ดูธุรกรรม
        </a>
        <div class="action-buttons">
          <a href="{{ url_for('accounts.edit', id=account.id) }}" class="btn btn-sm btn-outline-primary">
            <i class="fas fa-edit"></i>
          </a>
          <button type="button" class="btn btn-sm btn-outline-danger"
                  data-bs-toggle="modal" data-bs-target="#deleteAccount{{ account.id }}">
            <i class="fas fa-trash-alt"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Modal for deletion confirmation -->
    <div class="modal fade modal-bento" id="deleteAccount{{ account.id }}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">ยืนยันการลบบัญชี</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>คุณต้องการลบบัญชี "{{ account.name }}" ใช่หรือไม่?</p>
            {% if account.transactions.count() > 0 %}
            <div class="alert alert-danger">
              <i class="fas fa-exclamation-triangle me-2"></i>
              บัญชีนี้มีธุรกรรมอยู่ {{ account.transactions.count() }} รายการ
              คุณต้องลบธุรกรรมทั้งหมดก่อนจึงจะสามารถลบบัญชีได้
            </div>
            {% else %}
            <div class="alert alert-warning">
              <i class="fas fa-exclamation-triangle me-2"></i>
              การลบบัญชีเป็นการดำเนินการที่ไม่สามารถเรียกคืนได้
            </div>
            {% endif %}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ยกเลิก</button>
            <form action="{{ url_for('accounts.delete', id=account.id) }}" method="post">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button type="submit" class="btn btn-danger" {{ 'disabled' if account.transactions.count() > 0 }}>
                ยืนยันการลบ
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-state-icon">
      <i class="fas fa-wallet"></i>
    </div>
    <h4>ยังไม่มีบัญชี</h4>
    <p class="empty-state-text">คุณยังไม่ได้เพิ่มบัญชีใดๆ กรุณาเพิ่มบัญชีเพื่อเริ่มบันทึกรายรับรายจ่าย</p>
    <a href="{{ url_for('accounts.create') }}" class="btn btn-primary">
      <i class="fas fa-plus me-1"></i> เพิ่มบัญชีใหม่
    </a>
  </div>
  {% endif %}

  <!-- Mobile Bottom Navigation -->
  <div class="mobile-bottom-nav d-md-none">
    <a href="{{ url_for('dashboard.index') }}" class="mobile-nav-item">
      <i class="fas fa-home"></i>
      <span>หน้าหลัก</span>
    </a>
    <a href="{{ url_for('transactions.index') }}" class="mobile-nav-item">
      <i class="fas fa-exchange-alt"></i>
      <span>ธุรกรรม</span>
    </a>
    <a href="{{ url_for('accounts.index') }}" class="mobile-nav-item active">
      <i class="fas fa-wallet"></i>
      <span>บัญชี</span>
    </a>
    <a href="{{ url_for('reports.monthly') }}" class="mobile-nav-item">
      <i class="fas fa-chart-bar"></i>
      <span>รายงาน</span>
    </a>
  </div>

  <!-- Add Account FAB for mobile -->
  <a href="{{ url_for('accounts.create') }}" class="add-account-fab d-md-none">
    <i class="fas fa-plus"></i>
  </a>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Animated counters
    const counters = document.querySelectorAll('.counter-animate');
    counters.forEach(counter => {
      const target = parseFloat(counter.getAttribute('data-target'));
      const prefix = counter.getAttribute('data-prefix') || '';
      const suffix = counter.getAttribute('data-suffix') || '';
      const decimals = parseInt(counter.getAttribute('data-decimals')) || 0;

      const duration = 1500;
      const steps = 20;
      const increment = target / steps;
      const interval = duration / steps;

      let current = 0;
      const timer = setInterval(() => {
        current += increment;
        if (current > target) current = target;

        counter.textContent = prefix + current.toFixed(decimals).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + suffix;

        if (current >= target) {
          clearInterval(timer);
        }
      }, interval);
    });
  });
</script>
{% endblock %}